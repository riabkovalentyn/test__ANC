{% extends 'base.html' %}

{% block title %}Employee Hierarchy{% endblock %}

{% block content %}
<h1>Employee Hierarchy</h1>
<ul id="employee-tree">
    {{ employee_tree|safe }}
</ul>
{% endblock %}

{% block extra_js %}
<script>
$(function() {
    $("#employee-tree").sortable({
        connectWith: "#employee-tree",
        update: function(event, ui) {
            var employeeId = ui.item.data('id');
            var newManagerId = ui.item.parents('li').data('id');
            if (newManagerId) {
                $.ajax({
                    url: "{% url 'change_manager' %}",
                    method: 'POST',
                    data: {
                        'employee_id': employeeId,
                        'new_manager_id': newManagerId,
                        'csrfmiddlewaretoken': '{{ csrf_token }}'
                    },
                    success: function(data) {
                        if (data.success) {
                            alert("Manager updated successfully!");
                        } else {
                            alert("Error updating manager.");
                        }
                    }
                });
            }
        }
    }).disableSelection();
});
</script>
{% endblock %}